<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>
      Kalu - A calculator concept for long and inter-linked calculations
    </title>
    <meta name="author" content="Kushagra Gour" />
    <meta
      name="description"
      content="A calculator concept for long and inter-linked calculations"
    />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link
      href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;1,9..40,400&family=JetBrains+Mono:wght@400;500;600&display=swap"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="lib/codemirror/lib/codemirror.css" />
    <link rel="stylesheet" href="lib/codemirror/addon/hint/show-hint.css" />
    <link rel="stylesheet" href="lib/codemirror/theme/kalu-dark.css" />

    <style>
      /* ─── Design tokens ─────────────────────────────────── */
      :root {
        --bg-deep: #080e16;
        --bg-base: #0d1520;
        --bg-surface: #131d2a;
        --bg-raised: #182636;

        --accent: #00d4aa;
        --accent-rgb: 0, 212, 170;
        --accent-dim: rgba(var(--accent-rgb), 0.6);
        --accent-glow: rgba(var(--accent-rgb), 0.15);
        --border: rgba(var(--accent-rgb), 0.1);
        --border-strong: rgba(var(--accent-rgb), 0.2);

        --gold: #f0c674;
        --gold-dim: rgba(240, 198, 116, 0.85);
        --pink: #ff6b8a;
        --blue: #82c4fa;

        --text: #c8d3e0;
        --text-dim: #5a6d82;
        --text-muted: #3a4a5c;

        --font-ui: "DM Sans", system-ui, sans-serif;
        --font-mono: "JetBrains Mono", "SF Mono", "Fira Code", monospace;

        --radius: 8px;
        --radius-sm: 5px;

        --tab-h: 44px;
      }

      /* ─── Reset & base ──────────────────────────────────── */
      *,
      *::before,
      *::after {
        box-sizing: border-box;
      }

      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
      }

      body {
        overflow: hidden;
        background: var(--bg-deep);
        color: var(--text);
        font-family: var(--font-ui);
        font-size: 15px;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }

      /* Noise grain overlay for depth */
      body::before {
        content: "";
        position: fixed;
        inset: 0;
        z-index: 0;
        pointer-events: none;
        opacity: 0.025;
        background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
        background-repeat: repeat;
        background-size: 256px 256px;
      }

      /* Subtle top glow */
      body::after {
        content: "";
        position: fixed;
        top: -120px;
        left: 50%;
        transform: translateX(-50%);
        width: 600px;
        height: 300px;
        background: radial-gradient(
          ellipse,
          rgba(var(--accent-rgb), 0.06) 0%,
          transparent 70%
        );
        z-index: 0;
        pointer-events: none;
      }

      a {
        color: var(--accent);
        text-decoration: none;
      }
      a:hover {
        text-decoration: underline;
      }

      /* ─── Layout wrapper ────────────────────────────────── */
      .app-shell {
        position: relative;
        z-index: 1;
        display: flex;
        flex-direction: column;
        height: calc(100% - 32px);
      }

      /* ─── Header bar ────────────────────────────────────── */
      .header {
        display: flex;
        align-items: center;
        gap: 16px;
        height: 48px;
        padding: 0 20px;
        background: var(--bg-surface);
        border-bottom: 1px solid var(--border);
        flex-shrink: 0;
      }

      .header-brand {
        display: flex;
        align-items: center;
        gap: 8px;
        font-family: var(--font-mono);
        font-weight: 600;
        font-size: 16px;
        color: var(--accent);
        letter-spacing: -0.5px;
      }

      .header-brand-icon {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 26px;
        height: 26px;
        border-radius: 6px;
        background: linear-gradient(
          135deg,
          var(--accent),
          rgba(var(--accent-rgb), 0.7)
        );
        color: var(--bg-deep);
        font-size: 13px;
        font-weight: 600;
      }

      .header-tagline {
        color: var(--text-dim);
        font-size: 12px;
        letter-spacing: 0.02em;
      }

      .header-links {
        margin-left: auto;
        display: flex;
        gap: 14px;
        align-items: center;
      }

      .header-link {
        color: var(--text-dim);
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.06em;
        transition: color 0.2s;
      }

      .header-link:hover {
        color: var(--accent);
        text-decoration: none;
      }

      .header-link-sep {
        width: 1px;
        height: 14px;
        background: var(--border-strong);
      }

      /* ─── Tabs ──────────────────────────────────────────── */
      #tabs-container {
        display: flex;
        align-items: stretch;
        background: var(--bg-base);
        border-bottom: 1px solid var(--border);
        height: var(--tab-h);
        overflow-x: auto;
        overflow-y: hidden;
        flex-shrink: 0;
        scrollbar-width: thin;
        scrollbar-color: var(--bg-raised) var(--bg-base);
        padding-left: 4px;
      }

      #tabs-container::-webkit-scrollbar {
        height: 3px;
      }
      #tabs-container::-webkit-scrollbar-track {
        background: var(--bg-base);
      }
      #tabs-container::-webkit-scrollbar-thumb {
        background: var(--bg-raised);
        border-radius: 3px;
      }

      .tab {
        position: relative;
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 0 16px;
        height: var(--tab-h);
        color: var(--text-dim);
        cursor: pointer;
        font-size: 13px;
        font-weight: 400;
        letter-spacing: 0.01em;
        user-select: none;
        white-space: nowrap;
        min-width: 90px;
        max-width: 180px;
        transition:
          color 0.15s,
          background 0.15s;
        border-right: 1px solid var(--border);
      }

      .tab:hover {
        color: var(--text);
        background: rgba(var(--accent-rgb), 0.03);
      }

      .tab.active {
        color: var(--accent);
        background: var(--bg-surface);
        font-weight: 500;
      }

      .tab.active::after {
        content: "";
        position: absolute;
        bottom: 0;
        left: 8px;
        right: 8px;
        height: 2px;
        background: var(--accent);
        border-radius: 2px 2px 0 0;
        animation: tabSlide 0.25s ease-out;
      }

      @keyframes tabSlide {
        from {
          transform: scaleX(0);
        }
        to {
          transform: scaleX(1);
        }
      }

      .tab-title {
        flex: 1;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .tab-close {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 18px;
        height: 18px;
        border-radius: 4px;
        font-size: 14px;
        line-height: 1;
        opacity: 0;
        transition:
          opacity 0.15s,
          background 0.15s,
          color 0.15s;
        flex-shrink: 0;
      }

      .tab:hover .tab-close {
        opacity: 0.6;
      }
      .tab-close:hover {
        opacity: 1 !important;
        background: rgba(255, 107, 138, 0.15);
        color: var(--pink);
      }

      .new-page-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 38px;
        min-width: 38px;
        height: var(--tab-h);
        color: var(--text-muted);
        cursor: pointer;
        font-size: 18px;
        user-select: none;
        transition:
          color 0.15s,
          background 0.15s;
      }

      .new-page-btn:hover {
        color: var(--accent);
        background: var(--accent-glow);
      }

      /* ─── Editor container ──────────────────────────────── */
      #js-cm {
        flex: 1;
        min-height: 0;
        position: relative;
      }

      .CodeMirror {
        width: 100%;
        height: 100% !important;
        font-family: var(--font-mono);
        font-size: 15px;
        line-height: 1.7;
        letter-spacing: -0.01em;
        padding-top: 4px;
      }

      .CodeMirror-lines {
        padding: 8px 0;
      }

      .CodeMirror pre.CodeMirror-line,
      .CodeMirror pre.CodeMirror-line-like {
        padding: 0 12px 0 6px;
      }

      /* ─── Result badges ─────────────────────────────────── */
      .result {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        background: linear-gradient(
          135deg,
          rgba(240, 198, 116, 0.18) 0%,
          rgba(240, 198, 116, 0.1) 100%
        );
        color: var(--gold);
        font-family: var(--font-mono);
        font-size: 13px;
        font-weight: 500;
        padding: 0 10px;
        margin-left: 12px;
        border-radius: 4px;
        border: 1px solid rgba(240, 198, 116, 0.2);
        cursor: pointer;
        transform: translate(9px, -100%);
        z-index: 3;
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        transition:
          background 0.15s,
          border-color 0.15s,
          box-shadow 0.15s;
        white-space: nowrap;
      }

      .result::before {
        content: "=";
        color: rgba(240, 198, 116, 0.4);
        font-size: 11px;
        margin-right: 1px;
      }

      .result:hover {
        background: linear-gradient(
          135deg,
          rgba(240, 198, 116, 0.28) 0%,
          rgba(240, 198, 116, 0.16) 100%
        );
        border-color: rgba(240, 198, 116, 0.4);
        box-shadow: 0 0 16px rgba(240, 198, 116, 0.1);
      }

      /* ─── Reference highlights ──────────────────────────── */
      .reference-highlight {
        display: inline-flex;
        align-items: center;
        background: rgba(var(--accent-rgb), 0.12);
        color: var(--accent);
        border-radius: 3px;
        padding: 1px 6px;
        cursor: pointer;
        position: relative;
        font-weight: 500;
        font-family: var(--font-mono);
        font-size: 0.92em;
        border: 1px solid rgba(var(--accent-rgb), 0.15);
        transition:
          background 0.15s,
          border-color 0.15s;
      }

      .reference-highlight:hover {
        background: rgba(var(--accent-rgb), 0.22);
        border-color: rgba(var(--accent-rgb), 0.35);
      }

      .reference-highlight::after {
        content: "\2197";
        font-size: 0.75em;
        margin-left: 3px;
        opacity: 0.5;
      }

      /* ─── Line highlighting ─────────────────────────────── */
      .highlighted-line {
        background: rgba(var(--accent-rgb), 0.05) !important;
      }

      .target-line-highlight {
        background: rgba(var(--accent-rgb), 0.12) !important;
        transition: background 0.5s ease-out;
      }

      /* ─── Tooltips ──────────────────────────────────────── */
      .reference-highlight[title]:hover::before {
        content: attr(title);
        position: absolute;
        bottom: calc(100% + 6px);
        left: 0;
        background: var(--bg-raised);
        color: var(--text);
        padding: 5px 10px;
        border-radius: var(--radius-sm);
        border: 1px solid var(--border-strong);
        font-family: var(--font-mono);
        font-size: 11px;
        font-weight: 400;
        white-space: nowrap;
        z-index: 50;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
        pointer-events: none;
        animation: tooltipIn 0.15s ease-out;
      }

      /* Result badges use ::before for "=", so tooltip goes on ::after */
      .result[title]:hover::after {
        content: attr(title);
        position: absolute;
        bottom: calc(100% + 6px);
        left: 0;
        background: var(--bg-raised);
        color: var(--text);
        padding: 5px 10px;
        border-radius: var(--radius-sm);
        border: 1px solid var(--border-strong);
        font-family: var(--font-mono);
        font-size: 11px;
        font-weight: 400;
        white-space: nowrap;
        z-index: 50;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
        pointer-events: none;
        animation: tooltipIn 0.15s ease-out;
      }

      @keyframes tooltipIn {
        from {
          opacity: 0;
          transform: translateY(4px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* ─── Footer ──────────────────────────────────────── */
      .footer {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        z-index: 5;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 4px;
        background: var(--bg-surface);
        border-top: 1px solid var(--border);
        font-size: 11px;
        color: var(--text-muted);
      }

      .footer a {
        color: var(--text-dim);
        transition: color 0.2s;
      }

      .footer a:hover {
        color: var(--accent);
        text-decoration: none;
      }

      /* ─── Entrance animation ────────────────────────────── */
      @keyframes fadeUp {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .app-shell {
        animation: fadeUp 0.4s ease-out;
      }

      /* ─── Settings button ─────────────────────────────────── */
      .settings-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 30px;
        height: 30px;
        padding: 0;
        border: none;
        border-radius: 6px;
        background: transparent;
        color: var(--text-dim);
        cursor: pointer;
        transition:
          color 0.2s,
          background 0.2s;
      }

      .settings-btn:hover {
        color: var(--accent);
        background: rgba(var(--accent-rgb), 0.08);
      }

      /* ─── Settings pane & backdrop ─────────────────────── */
      .settings-backdrop {
        position: fixed;
        inset: 0;
        z-index: 90;
        background: rgba(0, 0, 0, 0.45);
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.25s ease;
      }

      .settings-backdrop.open {
        opacity: 1;
        pointer-events: auto;
      }

      .settings-pane {
        position: fixed;
        top: 0;
        right: 0;
        bottom: 0;
        width: 280px;
        z-index: 100;
        background: var(--bg-surface);
        border-left: 1px solid var(--border-strong);
        box-shadow: -8px 0 32px rgba(0, 0, 0, 0.4);
        transform: translateX(100%);
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        display: flex;
        flex-direction: column;
        font-family: var(--font-ui);
      }

      .settings-pane.open {
        transform: translateX(0);
      }

      .settings-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 16px 20px;
        border-bottom: 1px solid var(--border);
        flex-shrink: 0;
      }

      .settings-title {
        font-family: var(--font-mono);
        font-weight: 600;
        font-size: 14px;
        color: var(--text);
        letter-spacing: -0.3px;
      }

      .settings-close {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 28px;
        height: 28px;
        padding: 0;
        border: none;
        border-radius: 6px;
        background: transparent;
        color: var(--text-dim);
        font-size: 20px;
        cursor: pointer;
        transition:
          color 0.15s,
          background 0.15s;
      }

      .settings-close:hover {
        color: var(--text);
        background: var(--bg-raised);
      }

      .settings-body {
        flex: 1;
        overflow-y: auto;
        padding: 20px;
      }

      .settings-section {
        margin-bottom: 24px;
      }

      .settings-label {
        display: block;
        font-size: 11px;
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: var(--text-dim);
        margin-bottom: 12px;
      }

      /* ─── Accent swatches ──────────────────────────────── */
      .accent-swatches {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      .swatch {
        position: relative;
        width: 36px;
        height: 36px;
        border-radius: 50%;
        border: 2px solid transparent;
        background: var(--sw);
        cursor: pointer;
        padding: 0;
        transition:
          border-color 0.2s,
          transform 0.15s,
          box-shadow 0.2s;
        outline: none;
      }

      .swatch:hover {
        transform: scale(1.12);
        box-shadow: 0 0 12px rgba(var(--accent-rgb), 0.2);
      }

      .swatch.active {
        border-color: var(--text);
        box-shadow:
          0 0 0 2px var(--bg-surface),
          0 0 0 4px var(--sw);
      }

      .swatch-check {
        position: absolute;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
        font-weight: 700;
        color: var(--bg-deep);
        opacity: 0;
        transition: opacity 0.15s;
      }

      .swatch.active .swatch-check {
        opacity: 1;
      }

      /* ─── Autocomplete hint dropdown ─────────────────────── */
      .CodeMirror-hints {
        background: var(--bg-raised);
        border: 1px solid var(--border-strong);
        border-radius: var(--radius-sm);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.5);
        font-family: var(--font-mono);
        font-size: 13px;
        padding: 4px 0;
        z-index: 60;
        max-height: 180px;
        overflow-y: auto;
        scrollbar-width: thin;
        scrollbar-color: var(--bg-surface) var(--bg-raised);
      }

      .CodeMirror-hint {
        padding: 4px 12px;
        color: var(--text);
        cursor: pointer;
        white-space: nowrap;
        border-radius: 0;
        line-height: 1.5;
      }

      li.CodeMirror-hint-active {
        background: rgba(var(--accent-rgb), 0.15);
        color: var(--accent);
      }

      .hint-value {
        color: var(--text-muted);
        margin-left: 8px;
        font-size: 0.9em;
      }

      /* ─── Responsive ────────────────────────────────────── */
      @media (max-width: 600px) {
        .header-tagline {
          display: none;
        }
        .header-links {
          gap: 8px;
        }
        .CodeMirror {
          font-size: 14px;
        }
        .tab {
          min-width: 70px;
          padding: 0 10px;
          font-size: 12px;
        }
      }
    </style>
  </head>

  <body class="has-mouse">
    <footer class="footer">
      <span>Built by</span>
      <a href="https://x.com/cssMonk">Kushagra Gour</a>
    </footer>

    <div class="app-shell">
      <header class="header">
        <div class="header-brand">
          <span class="header-brand-icon">K</span>
          Kalu
        </div>
        <span class="header-tagline"
          >A calculator for long, interlinked calculations</span
        >
        <nav class="header-links">
          <a class="header-link" href="https://github.com/chinchang/kalu"
            >GitHub</a
          >
          <span class="header-link-sep"></span>
          <a class="header-link" href="https://kushagra.dev/lab/"
            >More projects</a
          >
          <span class="header-link-sep"></span>
          <button id="settings-btn" class="settings-btn" aria-label="Settings">
            <svg
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <circle cx="12" cy="12" r="3" />
              <path
                d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"
              />
            </svg>
          </button>
        </nav>
      </header>
      <div id="js-cm" class="cm"></div>
    </div>

    <!-- Settings side pane -->
    <div id="settings-backdrop" class="settings-backdrop"></div>
    <aside id="settings-pane" class="settings-pane">
      <div class="settings-header">
        <span class="settings-title">Settings</span>
        <button
          id="settings-close"
          class="settings-close"
          aria-label="Close settings"
        >
          &times;
        </button>
      </div>
      <div class="settings-body">
        <div class="settings-section">
          <label class="settings-label">Accent Color</label>
          <div id="accent-swatches" class="accent-swatches">
            <button
              class="swatch active"
              data-accent="green"
              data-color="#00d4aa"
              data-rgb="0,212,170"
              style="--sw: #00d4aa"
              aria-label="Green accent"
            >
              <span class="swatch-check">&#10003;</span>
            </button>
            <button
              class="swatch"
              data-accent="orange"
              data-color="#f0a050"
              data-rgb="240,160,80"
              style="--sw: #f0a050"
              aria-label="Orange accent"
            >
              <span class="swatch-check">&#10003;</span>
            </button>
            <button
              class="swatch"
              data-accent="pink"
              data-color="#ff6b8a"
              data-rgb="255,107,138"
              style="--sw: #ff6b8a"
              aria-label="Pink accent"
            >
              <span class="swatch-check">&#10003;</span>
            </button>
            <button
              class="swatch"
              data-accent="white"
              data-color="#c8d3e0"
              data-rgb="200,211,224"
              style="--sw: #c8d3e0"
              aria-label="White accent"
            >
              <span class="swatch-check">&#10003;</span>
            </button>
            <button
              class="swatch"
              data-accent="yellow"
              data-color="#f0c674"
              data-rgb="240,198,116"
              style="--sw: #f0c674"
              aria-label="Yellow accent"
            >
              <span class="swatch-check">&#10003;</span>
            </button>
          </div>
        </div>
      </div>
    </aside>

    <script src="lib/codemirror/lib/codemirror.js"></script>
    <script src="lib/codemirror/mode/javascript/javascript.js"></script>
    <script src="lib/codemirror/addon/edit/closebrackets.js"></script>
    <script src="lib/codemirror/addon/search/searchcursor.js"></script>
    <script src="lib/codemirror/addon/hint/show-hint.js"></script>
    <script src="lib/math.min.js"></script>

    <script src="script.js"></script>
    <script>
      if ("ontouchend" in document) {
        document.body.classList.remove("has-mouse");
      }
    </script>

    <script>
      var _gaq = _gaq || [];
      _gaq.push(["_setAccount", "UA-19798102-1"]);
      _gaq.push(["_trackPageview"]);
      (function () {
        var ga = document.createElement("script");
        ga.type = "text/javascript";
        ga.async = !0;
        ga.src =
          ("https:" == document.location.protocol
            ? "https://ssl"
            : "http://www") + ".google-analytics.com/ga.js";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </body>
</html>
